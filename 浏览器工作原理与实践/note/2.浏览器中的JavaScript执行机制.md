# 变量提升

**变量提升是指在JavaScript执行过程中，JavaScript引擎把变量和函数的声明部分提升到代码开头的“行为”。变量被提升后，会设置undefined为其默认值。**
<br/>
JavaScript代码的执行流程：
1. **编译阶段**，JavaScript代码在执行之前会被JavaScript引擎编译，变量提升就是发生在这个阶段的。
2. **执行阶段**

---

# 调用栈

> 栈是一种**后入先出的数据结构**，JavaScript引擎是利用栈结构来管理函数调用的。

以下面代码为例，分析JavaScript调用栈
```javascript
var a = 2
function add(b,c){
    return b+c
}
function addAll(b,c){
    var d = 10
    result = add(b,c)
    return  a+result+d
}
addAll(3,6)
```

1. **创建全局上下文，并将其压入栈底**
    @import "../images/stack1.png"
    此时，变量 a、函数 add 和 addAll 都保存到了全局上下文的变量环境对象中。之后，JavaScript引擎开始执行全局代码，为`a`变量赋值
2. **调用`addAll`函数**
    @import "../images/stack2.png"
3. **执行`add`函数**
    @import "../images/stack3.png"
4. 当 add 函数返回时，该函数的执行上下文就会从栈顶弹出，并将 result 的值设置为 add 函数的返回值，也就是 9。如下图所示：
    @import "../images/stack4.png"
5. 紧接着 addAll 执行最后一个相加操作后并返回，addAll 的执行上下文也会从栈顶部弹出，此时调用栈中就只剩下全局上下文了。最终如下图所示：
    @import "../images/stack5.png"

--- 

# 块级作用域
> **作用域是指在程序中定义变量的区域，该位置决定了变量的生命周期。通俗的理解，作用域就是变量与函数的可访问范围，即作用域控制着变量和函数的可见性和生命周期。**

ES6之前，作用域只有**全局作用域**和**函数作用域**两种，ES6中，又新增了**块级作用域**

# 作用域链和闭包
> **作用域链：**每个执行上下文的变量环境中，都包含了一个外部引用，用来指向外部的执行上下文，这个外部引用我们称之为**outer**。当一段代码中使用了一个变量时，JavaScript引擎会首先在当前执行上下文中查找该变量，如果没有查到，则会在outer所指向的执行上下文中查找。

> **闭包：**在JavaScript中，内部函数总是可以访问其外部函数中声明的变量，当通过调用一个外部函数返回一个内部函数后，即使该外部函数已经执行结束了，但是内部函数引用外部函数的变量依然保存在内存中，我们就把这些变量的集合称为闭包

---

# this

this是和执行上下文绑定的，分为**全局执行上下文中的this**和**函数执行上下文中的this**

* **全局执行上下文中的this**就是`window`对象
* **函数执行上下文中的this**分为三种情况
    * `call/apply/bind`方法中的this指向这些方法的参数
    * 通过对象调用方法时，this指向调用的对象
    * 构造函数中的this则指向此构造函数的实例